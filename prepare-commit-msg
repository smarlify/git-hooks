#!/bin/sh
# Gitmoji and Conventional Commits Helper
# This hook helps ensure consistent commit messages with Gitmoji and conventional commit format

# SAFE GIT PRACTICES REMINDER
# Always use --force-with-lease instead of --force when force pushing!
# --force-with-lease is safer as it checks if the remote has been updated by others
# Example: git push origin main --force-with-lease

# Gitmoji reference
GITMOJI_REF="
ğŸ¨ :art: improve structure / format of the code
âš¡ï¸ :zap: improve performance
ğŸ”¥ :fire: remove code or files
ğŸ› :bug: fix a bug
ğŸš‘ï¸ :ambulance: critical hotfix
âœ¨ :sparkles: introduce new features
ğŸ“ :memo: add or update documentation
ğŸš€ :rocket: deploy stuff
ğŸ’„ :lipstick: add or update the UI and style files
ğŸ‰ :tada: begin a project
âœ… :white_check_mark: add, update, or pass tests
ğŸ”’ï¸ :lock: fix security issues
ğŸ”– :bookmark: release / version tags
ğŸŒ :globe_with_meridians: internationalization and localization
ğŸ’š :green_heart: fix CI Build
â¬‡ï¸ :arrow_down: downgrade dependencies
â¬†ï¸ :arrow_up: upgrade dependencies
ğŸ“Œ :pushpin: pin dependencies to specific versions
ğŸ‘· :construction_worker: add or update CI build system
ğŸ“ˆ :chart_with_upwards_trend: add or update analytics or track code
â™»ï¸ :recycle: refactor code
â• :heavy_plus_sign: add a dependency
â– :heavy_minus_sign: remove a dependency
ğŸ”§ :wrench: add or update configuration files
ğŸ”¨ :hammer: add or update development scripts
ğŸŒ :earth_americas: fix text and literals
ğŸ’© :poop: write bad code that needs to be improved
âªï¸ :rewind: revert changes
ğŸ”€ :twisted_rightwards_arrows: merge branches
ğŸ“¦ :package: add or update compiled files or packages
ğŸ‘½ï¸ :alien: update code due to external API changes
ğŸšš :truck: move or rename resources (e.g.: files, paths, routes)
ğŸ“„ :page_facing_up: add or update license
ğŸ’¥ :boom: introduce breaking changes
ğŸ± :bento: add or update assets
â™¿ï¸ :wheelchair: improve accessibility
ğŸ’¡ :bulb: add or update comments in source code
ğŸ» :beers: write code drunkenly
ğŸ’¬ :speech_balloon: add or update text and literals
ğŸ—ƒï¸ :card_file_box: perform database related changes
ğŸ”Š :loud_sound: add or update logs
ğŸ”‡ :mute: remove logs
ğŸ‘¥ :busts_in_silhouette: add or update contributor(s)
ğŸš¸ :children_crossing: improve user experience / usability
ğŸ—ï¸ :building_construction: make architectural changes
ğŸ“± :iphone: work on responsive design
ğŸ¤¡ :clown_face: mock things
ğŸ¥š :egg: add or update an easter egg
ğŸ™ˆ :see_no_evil: add or update a .gitignore file
ğŸ“¸ :camera_flash: add or update snapshots
âš™ï¸ :gear: add or update configuration
ğŸ©¹ :adhesive_bandage: simple fix for a non-critical issue
ğŸ§ :monocle_face: data exploration/inspection
âš—ï¸ :alembic: perform experiments
ğŸ” :mag: improve SEO
â˜¸ï¸ :wheel_of_dharma: work about containerization
ğŸ·ï¸ :label: add or update types
ğŸŒ± :seedling: add or update seed files
ğŸš© :triangular_flag_on_post: add, update, or remove feature flags
ğŸ¥… :goal_net: catch errors
ğŸ’« :dizzy: add or update animations and transitions
ğŸ—‘ï¸ :wastebasket: remove code or files
ğŸ›‚ :passport_control: work on code related to authorization, roles and permissions
ğŸ›ƒ :customs: work on internationalization
ğŸ›„ :baggage_claim: work on code related to logging
ğŸ›… :left_luggage: work on code related to validation
ğŸ›‹ï¸ :couch_and_lamp: work on code related to the UI/UX
ğŸ›ï¸ :bed: work on code related to the UI/UX
ğŸ› ï¸ :hammer_and_wrench: work on code related to the UI/UX
ğŸ›¡ï¸ :shield: work on code related to security
ğŸ›¢ï¸ :oil_drum: work on code related to configuration
ğŸ›£ï¸ :motorway: work on code related to routing
ğŸ›¤ï¸ :railway_track: work on code related to routing
ğŸ›¥ï¸ :motor_boat: work on code related to routing
ğŸ›©ï¸ :small_airplane: work on code related to routing
ğŸ›« :airplane_departure: work on code related to routing
ğŸ›¬ :airplane_arriving: work on code related to routing
ğŸ›°ï¸ :satellite: work on code related to routing
ğŸ›³ï¸ :passenger_ship: work on code related to routing
ğŸ›´ :kick_scooter: work on code related to routing
ğŸ›µ :motor_scooter: work on code related to routing
ğŸ›¶ :canoe: work on code related to routing
ğŸ›· :sled: work on code related to routing
ğŸ›¸ :flying_saucer: work on code related to routing
ğŸ›¹ :skateboard: work on code related to routing
ğŸ›º :auto_rickshaw: work on code related to routing
"

# Function to show gitmoji help
show_gitmoji_help() {
    echo "ğŸ¯ Gitmoji Reference:"
    echo "$GITMOJI_REF"
    echo ""
    echo "ğŸ“ Conventional Commit Format:"
    echo "<gitmoji> <type>(<scope>): <description>"
    echo ""
    echo "Examples:"
    echo "âœ¨ feat(auth): add OAuth2 login"
    echo "ğŸ› fix(api): resolve user validation error"
    echo "ğŸ“ docs(readme): update installation guide"
    echo "ğŸ¨ style(ui): improve button hover effects"
    echo "â™»ï¸ refactor(utils): simplify date formatting"
    echo ""
}

# Function to prompt for commit message
prompt_commit_message() {
    echo "ğŸ¯ Gitmoji & Conventional Commits Helper"
    echo "=========================================="
    echo ""
    
    # Show help if requested
    if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
        show_gitmoji_help
        exit 0
    fi
    
    # Get current branch
    BRANCH=$(git rev-parse --abbrev-ref HEAD)
    
    # Get staged files
    STAGED_FILES=$(git diff --cached --name-only)
    
    echo "ğŸ“‹ Current branch: $BRANCH"
    echo "ğŸ“ Staged files:"
    echo "$STAGED_FILES" | sed 's/^/  - /'
    echo ""
    
    # Suggest commit type based on staged files
    if echo "$STAGED_FILES" | grep -q "\.md$"; then
        SUGGESTED_TYPE="docs"
        SUGGESTED_EMOJI="ğŸ“"
    elif echo "$STAGED_FILES" | grep -q "test"; then
        SUGGESTED_TYPE="test"
        SUGGESTED_EMOJI="âœ…"
    elif echo "$STAGED_FILES" | grep -q "style\|css\|scss"; then
        SUGGESTED_TYPE="style"
        SUGGESTED_EMOJI="ğŸ¨"
    elif echo "$STAGED_FILES" | grep -q "package\.json\|yarn\.lock\|package-lock\.json"; then
        SUGGESTED_TYPE="build"
        SUGGESTED_EMOJI="â¬†ï¸"
    else
        SUGGESTED_TYPE="feat"
        SUGGESTED_EMOJI="âœ¨"
    fi
    
    echo "ğŸ’¡ Suggested: $SUGGESTED_EMOJI $SUGGESTED_TYPE"
    echo ""
    
    # Prompt for commit message
    read -p "ğŸ¯ Enter your commit message (or 'help' for gitmoji reference): " COMMIT_MSG
    
    if [ "$COMMIT_MSG" = "help" ]; then
        show_gitmoji_help
        prompt_commit_message
        return
    fi
    
    # If no message provided, use suggested
    if [ -z "$COMMIT_MSG" ]; then
        COMMIT_MSG="$SUGGESTED_TYPE: update staged files"
    fi
    
    # Write to commit message file
    echo "$SUGGESTED_EMOJI $COMMIT_MSG" > "$1"
}

# Main execution
if [ "$1" = "prepare-commit-msg" ]; then
    prompt_commit_message "$2"
fi
